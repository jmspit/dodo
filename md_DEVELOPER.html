<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>dodo: Developer manual</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">dodo
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">A C++ library to create containerized Linux services</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_DEVELOPER.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Developer manual </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md10">Introduction</a></li>
<li class="level1"><a href="#autotoc_md11">Using dodo</a></li>
<li class="level1"><a href="#autotoc_md12">Exception and error handling</a></li>
<li class="level1"><a href="#autotoc_md13">Deployment configuration</a></li>
<li class="level1"><a href="#autotoc_md14">Logging</a></li>
<li class="level1"><a href="#autotoc_md15">Bytes</a></li>
<li class="level1"><a href="#autotoc_md16">Encryption</a></li>
<li class="level1"><a href="#autotoc_md17">Networking</a><ul><li class="level2"><a href="#autotoc_md18">Address</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md19">Sockets</a><ul><li class="level2"><a href="#autotoc_md20">Sockets</a></li>
<li class="level2"><a href="#developer_networking">Secure sockets</a><ul><li class="level3"><a href="#autotoc_md21">Transport Layer Security (TLS)</a></li>
<li class="level3"><a href="#autotoc_md22">Setup Certification Authority</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md23">TCPListener / TCPServer</a></li>
<li class="level1"><a href="#autotoc_md24">Persistent data</a><ul><li class="level2"><a href="#autotoc_md25">SQLite wrapper</a></li>
<li class="level2"><a href="#autotoc_md26">KVStore</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md27">Performance</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md10"></a>
Introduction</h1>
<p>Framework to create C++ services for deployment in Docker containers. The framework strives to</p>
<ul>
<li>Target is GNU/Linux exclusively.</li>
<li>Use STL primitives such as std::string for every 'string type' such as a host or file name.</li>
<li>Application class handles red tape<ul>
<li>Runtime configuration through yaml file(s).</li>
<li>Logging to one or more destinations, console, (rotating) files, syslog.</li>
<li>Handling signals (to the container entrypoint, including stop requests)</li>
</ul>
</li>
<li>Frameworks for additional demands such as<ul>
<li>Encryption</li>
<li>Network and TLS network sockets</li>
<li>TCP servers</li>
<li>HTTP servers</li>
<li>REST servers</li>
<li>Database abstractions<ul>
<li>PostgreSQL</li>
<li>MongoDB</li>
<li>SQLite</li>
</ul>
</li>
<li>Persistent Key-Value store, FIFO and priority queues (based on SQLite)</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md11"></a>
Using dodo</h1>
<p>Include all dodo headers by including <a class="el" href="dodo_8hpp.html" title="Includes all dodo headers.">dodo.hpp</a>. Before using any of the dodo functionality, call <a class="el" href="namespacedodo.html#ae61f6a99a376fce96aaa28ef8fc99d24" title="Initialize the dodo library.">dodo::initLibrary()</a>. Call <a class="el" href="namespacedodo.html#a0e6bd0f6e43779dd148e7fda07e67c23" title="Close the dodo library.">dodo::closeLibrary()</a> to clean up before program termination.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dodo_8hpp.html">dodo.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacedodo.html">dodo</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[] ) {</div>
<div class="line">  <span class="keywordtype">int</span> return_code = 0;</div>
<div class="line">  <a class="code" href="namespacedodo.html#ae61f6a99a376fce96aaa28ef8fc99d24">initLibrary</a>();</div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    <a class="code" href="classdodo_1_1network_1_1Address.html">network::Address</a> localhost = <span class="stringliteral">&quot;127.0.0.1&quot;</span>;</div>
<div class="line">    ...</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span> ( <span class="keyword">const</span> std::exception &amp;e ) {</div>
<div class="line">    cerr &lt;&lt; e.what() &lt;&lt; endl;</div>
<div class="line">    return_code = 1;</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="namespacedodo.html#a0e6bd0f6e43779dd148e7fda07e67c23">closeLibrary</a>();</div>
<div class="line">  <span class="keywordflow">return</span> return_code;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Or use the <a class="el" href="classdodo_1_1common_1_1Application.html" title="Red tape wrapper class for applications, from command line to services.">dodo::common::Application</a> class, as that will take care of</p>
<ul>
<li>initializing / unloading the dodo library</li>
<li>install signal handlers</li>
<li>parse command line arguments, read environment variables</li>
<li>read configuration data from the specified configuration file.</li>
<li>logging</li>
</ul>
<p>Subclass Application and implement the run method</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dodo_8hpp.html">dodo.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacedodo.html">dodo</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MyApp : <span class="keyword">public</span> <a class="code" href="classdodo_1_1common_1_1Application.html">common::Application</a> {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">    MyApp( <span class="keyword">const</span> StartParameters &amp;param ) : common::Application( param ) {}</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">int</span> run() {</div>
<div class="line">      <span class="keywordflow">while</span> ( !hasStopRequest() ) {</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Hello world!&quot;</span> &lt;&lt; endl;</div>
<div class="line">        std::this_thread::sleep_for(2s);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[], <span class="keywordtype">char</span>** envp ) {</div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    MyApp app( { <span class="stringliteral">&quot;conf/myapp.yaml&quot;</span>, argc, argv, envp } );</div>
<div class="line">    <span class="keywordflow">return</span> app.run();</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span> ( <span class="keyword">const</span> std::exception &amp;e ) {</div>
<div class="line">    cerr &lt;&lt; e.what() &lt;&lt; endl;</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md12"></a>
Exception and error handling</h1>
<p>Dodo throws <a class="el" href="classdodo_1_1common_1_1Exception.html" title="An Exception is thrown in exceptional circumstances, and its occurrence should generally imply that t...">dodo::common::Exception</a> (or its descendant <a class="el" href="classdodo_1_1common_1_1SystemException.html" title="Descending from Exception, exceptions based on a dodo::common::SystemError code.">dodo::common::SystemException</a>) only in exceptional circumstances. Methods that might be expected to fail return a SystemError, a mapping of of system and internal dodo errors which are more convenient in writing program flows.</p>
<p>Among the exceptional error conditions that will <em>throw</em> are</p>
<ul>
<li>specifying an non-existing configuration file</li>
<li>loading an invalid private key</li>
<li>unable to allocate memory</li>
</ul>
<p>whilst <a class="el" href="classdodo_1_1common_1_1SystemError.html" title="Linux system error primitive to provide a consistent interface to Linux error codes.">dodo::common::SystemError</a> is <em>returned</em> when, for example,</p>
<ul>
<li>a fqdn fails to resolve</li>
<li>send / receive timeouts</li>
</ul>
<p>As <a class="el" href="classdodo_1_1common_1_1Exception.html" title="An Exception is thrown in exceptional circumstances, and its occurrence should generally imply that t...">dodo::common::Exception</a> itself descends from std::runtime_error, which in turn descends from std::exception, a try / catch block such as</p>
<div class="fragment"><div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">  ...</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">catch</span> ( <span class="keyword">const</span> std::exception &amp;e ) {</div>
<div class="line">  cerr &lt;&lt; e.what() &lt;&lt; endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>will also catch any dod exception. <a class="el" href="classdodo_1_1common_1_1Exception.html" title="An Exception is thrown in exceptional circumstances, and its occurrence should generally imply that t...">dodo::common::Exception</a> instances include the file and line number where the Exception was thrown. Developers may use the <a class="el" href="exception_8hpp.html#adbbe8bef2f0a542a39a49064f0498f29" title="Throws an Exception, passes FILE and LINE to constructor.">throw_Exception()</a> macro's that are used by dodo internally.</p>
<p>The <a class="el" href="classdodo_1_1common_1_1SystemError.html" title="Linux system error primitive to provide a consistent interface to Linux error codes.">dodo::common::SystemError</a> is declared <code>[[nodiscard]]</code> so that the compiler issues a warning if any function returns a <a class="el" href="classdodo_1_1common_1_1SystemError.html" title="Linux system error primitive to provide a consistent interface to Linux error codes.">dodo::common::SystemError</a> that is ignored.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Deployment configuration</h1>
<p>The <a class="el" href="classdodo_1_1common_1_1Config.html" title="Singleton interface to a (read-only) deployment configuration, combining data from the deployment con...">dodo::common::Config</a> interface enforces the use of a YAML configuration file with mandatory keys:</p>
<div class="fragment"><div class="line">dodo:                 # mandatory must be a root key</div>
<div class="line">  common:             # mandatory</div>
<div class="line">    application:      # mandatory</div>
<div class="line">      name: myapp     # an arbitrary name for the application</div>
<div class="line">    logger:           # mandatory</div>
<div class="line">      console:        # at least one of &#39;console&#39;, &#39;file&#39;, &#39;syslog&#39;</div>
<div class="line">        level: info   # mandatory</div>
</div><!-- fragment --><p>A dodo Application configuration requires at least a name ('myapp') and a <a class="el" href="classdodo_1_1common_1_1Logger.html#a598af7d276b90b90c48b7f824b8ed2cb" title="The level of a log entry.">dodo::common::Logger::LogLevel</a> ('info') and a log destination ('console','file','syslog').</p>
<p>The dodo mandatory key tree can appear anywhere in the YAML as long as <code>dodo</code> is a root node. Other dodo interfaces read from this configuration file as well, such as <a class="el" href="classdodo_1_1network_1_1TLSContext.html" title="TLS security context.">dodo::network::TLSContext</a>.</p>
<p>Values can either by strings, integers, floating point or boolean values. Some of this data may sensisitive and thus needs to be in encrypted form. To decrypt a secret is required, whose source is specified by the configuration file:</p>
<div class="fragment"><div class="line">dodo:                           # mandatory must be a root key</div>
<div class="line">  common:                       # mandatory</div>
<div class="line">    application:                # mandatory</div>
<div class="line">      name: myapp               # an arbitrary name for the application</div>
<div class="line">      secret:                   # either &#39;file&#39; ir &#39;env&#39;</div>
<div class="line">        file: &lt;mounted secret&gt;  # path to the mounted secret</div>
<div class="line">        env: &lt;name of env var&gt;  # name of the ENV var</div>
<div class="line">    logger:                     # mandatory</div>
<div class="line">      console:                  # at least one of &#39;console&#39;, &#39;file&#39;, &#39;syslog&#39;</div>
<div class="line">        level: info             # mandatory</div>
<div class="line"> </div>
<div class="line">sensitive: ENC[chipher:...]     # some sensitive data</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md14"></a>
Logging</h1>
<p>A logging framework is available to write log entries to one or more destinations. The available destinations are</p>
<ul>
<li>standard output aka the console of the container (assuming the Application is the entrypoint)</li>
<li>a directory with a file rotation policy</li>
<li>the syslog</li>
</ul>
<p>The logging interface is thread-safe.</p>
<p>The <a class="el" href="classdodo_1_1common_1_1Logger.html" title="A Logger interface.">dodo::common::Logger</a> is configured through the <a class="el" href="classdodo_1_1common_1_1Config.html" title="Singleton interface to a (read-only) deployment configuration, combining data from the deployment con...">dodo::common::Config</a> configuration file. Minimally, the Logger requires</p>
<div class="fragment"><div class="line">dodo:</div>
<div class="line">  common:</div>
<div class="line">    logger:</div>
<div class="line">      console:</div>
<div class="line">        level: info</div>
</div><!-- fragment --><p>which specifies that log entries should be sent to the console (standard out) if they are level <a class="el" href="classdodo_1_1common_1_1Logger.html#a598af7d276b90b90c48b7f824b8ed2cba4059b0251f66a18cb56f544728796875" title="The program signaled an informational message.">dodo::common::Logger::LogLevel::Info</a> or worse.</p>
<p>The other destinations are file and syslog. The logger writes entries to all destinations specified (so console logging cannot be disabled). The file destination requires directory and trailing limits specifications as the log files are rotated automatically. <code>max-size-mib</code> (the maximum size of a file before rotate) and <code>max-file-trail</code> (the maximum number of already rotated log files to keep, oldest removed if exceeded) may be omitted, in which case they have the values as specified below. The directory must be specified and may be relative to the current working directory.</p>
<div class="fragment"><div class="line">dodo:</div>
<div class="line">  common:</div>
<div class="line">    logger:                       # mandatory</div>
<div class="line">      console:                    # mandatory</div>
<div class="line">        level: info               # mandatory</div>
<div class="line">      file:                       # optional</div>
<div class="line">        level: info               # mandatory</div>
<div class="line">        directory: log            # mandatory</div>
<div class="line">        max-size-mib: 10          # optional default 10</div>
<div class="line">        max-file-trail: 4         # optional default 4</div>
</div><!-- fragment --><p>So the space needed for a logging config is <code>max-size-mib</code> * ( <code>max-file-trail</code> + 1 ) MiB.</p>
<p>The <a class="el" href="classdodo_1_1common_1_1Logger.html#a598af7d276b90b90c48b7f824b8ed2cb" title="The level of a log entry.">dodo::common::Logger::LogLevel</a> levels can be specified in the configuration in either a short or longer format, but the shorter format will be used in log entries written to console or file. So <code>level: fatal</code> and <code>level: FAT</code> are equivalent.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">short </th><th class="markdownTableHeadNone">long </th><th class="markdownTableHeadNone">syslog mapping </th><th class="markdownTableHeadNone">Release build  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>FAT</code> </td><td class="markdownTableBodyNone"><code>fatal</code> </td><td class="markdownTableBodyNone">2 CRITICAL </td><td class="markdownTableBodyNone">Included in code  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>ERR</code> </td><td class="markdownTableBodyNone"><code>error</code> </td><td class="markdownTableBodyNone">3 ERROR </td><td class="markdownTableBodyNone">Included in code  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>WRN</code> </td><td class="markdownTableBodyNone"><code>warning</code> </td><td class="markdownTableBodyNone">4 WARNING </td><td class="markdownTableBodyNone">Included in code  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>INF</code> </td><td class="markdownTableBodyNone"><code>info</code> </td><td class="markdownTableBodyNone">6 INFORMATIONAL </td><td class="markdownTableBodyNone">Included in code  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>STA</code> </td><td class="markdownTableBodyNone"><code>statistics</code> </td><td class="markdownTableBodyNone">6 INFORMATIONAL </td><td class="markdownTableBodyNone">Included in code  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>DBG</code> </td><td class="markdownTableBodyNone"><code>debug</code> </td><td class="markdownTableBodyNone">not logged </td><td class="markdownTableBodyNone">Excluded from code  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>TRC</code> </td><td class="markdownTableBodyNone"><code>trace</code> </td><td class="markdownTableBodyNone">not logged </td><td class="markdownTableBodyNone">Excluded from code  </td></tr>
</table>
<p>So it is not possible to debug or trace to the syslog, and debug and trace loglevels have no effect in release builds.</p>
<p>To log messages in the code, use the log_Fatal through log_Trace macros (all include an implicit Puts() so streaming syntax can be used to easily log different data-types). For example</p>
<div class="fragment"><div class="line"><a class="code" href="logger_8hpp.html#a4b3fd9bbb39ca533a533155265dc9129">log_Debug</a>( <span class="stringliteral">&quot;connection from &quot;</span> &lt;&lt; address.AsString() );</div>
<div class="line"><a class="code" href="logger_8hpp.html#a16c263117aeb5970df2838dffa168b70">log_Error</a>( <span class="stringliteral">&quot;receive timeout on socket &quot;</span> &lt;&lt; socket.getFD() );</div>
</div><!-- fragment --><p>In release builds (<code>-DNDEBUG</code>) the log_Debug and log_Trace macros reduce to void and are thus eliminated from the code, and the above fragment would reduce to</p>
<div class="fragment"><div class="line"><a class="code" href="logger_8hpp.html#a16c263117aeb5970df2838dffa168b70">log_Error</a>( <span class="stringliteral">&quot;receive timeout on socket &quot;</span> &lt;&lt; socket.getFD() );</div>
</div><!-- fragment --><p>To configure the syslog destination</p>
<div class="fragment"><div class="line">dodo:</div>
<div class="line">  common:</div>
<div class="line">    logger:                       # mandatory</div>
<div class="line">      console:                    # mandatory</div>
<div class="line">        level: info               # mandatory</div>
<div class="line">      syslog:                     # mandatory</div>
<div class="line">        level: warning            # mandatory</div>
<div class="line">        facility: 1               # optional default 1</div>
</div><!-- fragment --><p>The syslog facility should be either 1 for <code>user-level messages</code> or in the range <code>local0</code> to <code>local7</code> or 16 through 23 as the remaining values are reserved for other use.</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Bytes</h1>
<p>Dodo provides the <a class="el" href="classdodo_1_1common_1_1Bytes.html" title="An array of Octets with size elements.">dodo::common::Bytes</a> class as a primitive used by other interfaces suchs as <a class="el" href="classdodo_1_1network_1_1BaseSocket.html" title="Interface to and common implementation of concrete sockets (Socket, TLSSocket).">dodo::network::BaseSocket</a>, <a class="el" href="classdodo_1_1common_1_1DataCrypt.html" title="Interface to encrypt and decrypt Bytes data to/from a secure string.">dodo::common::DataCrypt</a>, <a class="el" href="classdodo_1_1network_1_1protocol_1_1http_1_1HTTPResponse.html" title="HTTPResponse class.">dodo::network::protocol::http::HTTPResponse</a>, <a class="el" href="classdodo_1_1persist_1_1sqlite_1_1Query.html" title="Queries can take bind values and return select lists.">dodo::persist::sqlite::Query</a> and so on. A Bytes object is just a sequence of <a class="el" href="namespacedodo_1_1common.html#a9a35ee0c56674639dcfdd4e539e50a54" title="Octet aka &#39;byte&#39;.">dodo::common::Octet</a> (an alias for uint8_t, a group of 8 bits). The class allows to append other things (C++ primitives, and other Bytes) and handles memory management internally. It provides functions to encode / decode to base64 strings, or generate random data through the openssl library.</p>
<p>A difference between Bytes and a 'string' is that Bytes are not zero terminated, nor does it attribute any special meaning to any Octet value. This means that a Bytes object is not always translatable to a 'string' (the Bytes may include intermediate zeros), but any string can always be represented by a Bytes object.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Encryption</h1>
<p>Dodo provides the <a class="el" href="classdodo_1_1common_1_1DataCrypt.html" title="Interface to encrypt and decrypt Bytes data to/from a secure string.">dodo::common::DataCrypt</a> interface to encrypt and decrypt secret <a class="el" href="classdodo_1_1common_1_1Bytes.html" title="An array of Octets with size elements.">dodo::common::Bytes</a>, such as a passphrase in a YAML configuration file. The DataCrypt interface uses a formatted string</p>
<div class="fragment"><div class="line">$ echo -n &quot;Hello world&quot; | bin/cryptstr -e -c EVP_aes_256_gcm -kval:secret</div>
<div class="line">ENC[cipher:EVP_aes_256_gcm,data:8GIwcMJW8YKNHwQ=,iv:CdwuYqQ0u/cLsI0EGAiA+A==,tag:s1YHIH3/6x1G/IpVLXWsrg==]</div>
</div><!-- fragment --><p>The format specifies all information to decrypt the data (except obviously the key aka passphrase), and uses openssl encryption internally. The cryptstr tool is provided in the dodo repository. To decrypt the above data in appliction code, do something like</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> std::string &amp;key = whatever;</div>
<div class="line"><span class="keyword">const</span> Bytes src = <span class="stringliteral">&quot;ENC[cipher:EVP_aes_256_gcm,data:3r+TAD2bmQNXE4+t,iv:TSq6XIUI3rdzAphofSTUJg==,tag:z+T1aC99QaJ8G77+lypD1w==]&quot;</span>;</div>
<div class="line">Bytes dest;</div>
<div class="line">DataCrypt::decrypt( key, src, dest );</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md17"></a>
Networking</h1>
<p>The networking framework is provided by the <a class="el" href="namespacedodo_1_1network.html" title="Interface for network communication.">dodo::network</a> namespace.</p>
<h2><a class="anchor" id="autotoc_md18"></a>
Address</h2>
<p>Sockets connect to or listen on Address objects. The Address class allow to program for both ipv4 and ipv6 transparently. For example, the following sequence resolves the name "httpbin.org" to either an ipv4 or ipv6 address, whatever the server and client support.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacedodo.html">dodo</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classdodo_1_1network_1_1SocketParams.html">network::SocketParams</a> sock_params = <a class="code" href="classdodo_1_1network_1_1SocketParams.html">network::SocketParams</a>( network::SocketParams::afUNSPEC,</div>
<div class="line">                                                           network::SocketParams::stSTREAM,</div>
<div class="line">                                                           network::SocketParams::pnTCP );</div>
<div class="line">std::string canonicalname;</div>
<div class="line">std::string host = <span class="stringliteral">&quot;httpbin.org&quot;</span>;</div>
<div class="line"><a class="code" href="classdodo_1_1network_1_1Address.html">network::Address</a> address;</div>
<div class="line"><a class="code" href="classdodo_1_1common_1_1SystemError.html">common::SystemError</a> error = <a class="code" href="classdodo_1_1network_1_1Address.html#a7a68ac2e0566d16ddaad9c5484053d12">network::Address::getHostAddrInfo</a>( host, sock_params, address, canonicalname );</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md19"></a>
Sockets</h1>
<p>Both <a class="el" href="classdodo_1_1network_1_1Socket.html" title="A Linux socket.">dodo::network::Socket</a> and <a class="el" href="classdodo_1_1network_1_1TLSSocket.html" title="Socket for TLS encrypted traffic between trusted endpoints.">dodo::network::TLSSocket</a> classes implement the from <a class="el" href="classdodo_1_1network_1_1BaseSocket.html" title="Interface to and common implementation of concrete sockets (Socket, TLSSocket).">dodo::network::BaseSocket</a> interface.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Sockets</h2>
<p>Dodo provides the <a class="el" href="classdodo_1_1network_1_1Socket.html" title="A Linux socket.">dodo::network::Socket</a> interface to manage network sockets.</p>
<h2><a class="anchor" id="developer_networking"></a>
Secure sockets</h2>
<p>Dodo supports TLS through <a class="el" href="classdodo_1_1network_1_1TLSContext.html" title="TLS security context.">dodo::network::TLSContext</a> and <a class="el" href="classdodo_1_1network_1_1TLSSocket.html" title="Socket for TLS encrypted traffic between trusted endpoints.">dodo::network::TLSSocket</a>.</p>
<h3><a class="anchor" id="autotoc_md21"></a>
Transport Layer Security (TLS)</h3>
<p><img src="https://raw.githubusercontent.com/jmspit/dodo/master/src/doc/img/asymmetric_key_encryption.png" alt="Test Image 4" class="inline"/></p>
<p>The core principle to asymmetric cryptography is a mathematical mapping that is cheap to compute in one direction, and computationally infeasible in the other. Typically, the ease of muliplying primes and the difficulty in finding prime roots of integers is applied.</p>
<p>In an asymmetric communication handshake, each endpoint has a private key, a <em>secret</em> filled with as much entropy as possible, typically stored as a file which is (or should be) in turn encrypted and protected by a passphrase. The private key is and must not be shared with anyone. The passphrase redces the risk when the private key leaks, and must not be allowed to be empty.</p>
<p>The private key includes public bits that map uniquely to a public key, which can thus be extracted from the private key. The private and its public key share the same <em>modulus</em>, so a public key can be matched to a private key and other artifacts containing that public key, such as a certificate or certificate signing request.</p>
<p>In secure communication, the public key encrypts and the private key decrypts. So data encrypted with a public key, can only be decrypted by the owner of the matching private key.</p>
<p>In digital signing, the signature is encrypted with the private key of the signer, and decrypted with the public key of the signer.</p>
<p>TLS is a secure communication protocol that use an asymmetric cryptographic handshake to negotiate and share a session key, which will be used for both encryption and decryption.</p>
<p>In TLS configuration and deployment the following document types are used (see <a class="el" href="classdodo_1_1network_1_1X509Common.html#a072fef8b03e3c6ccd2fa35d95e0556db" title="Enumeration of X509 document types.">dodo::network::X509Common::X509Type</a>)</p>
<ul>
<li>The private key.</li>
<li>A <em>certificate signing request</em> (CSR) which is a X.509 document (<a class="el" href="classdodo_1_1network_1_1X509CertificateSigningRequest.html" title="X509 Certificate signing request (CSR) interface.">dodo::network::X509CertificateSigningRequest</a>), typically stored as a PEM file, and comprises<ul>
<li>the public key</li>
<li>data describing the owner identity (often the FQDN)</li>
<li>defined limits to its validty (such as expiry by date)</li>
</ul>
</li>
<li>A <em>certificate</em>, which is a X.509 document (<a class="el" href="classdodo_1_1network_1_1X509Certificate.html" title="X509 public key certificate (PKC) interface.">dodo::network::X509Certificate</a>) typically stored as a PEM file, and comprises<ul>
<li>the public key as in the CSR.</li>
<li>data describing the owner as in the CSR.</li>
<li>The digital signature of a Certificate Authority (CA) that has verified the CSR to be correct (the FQDN belongs to the owner described in the data).</li>
</ul>
</li>
</ul>
<p>A CA is a chain of certificates anchored to a trust anchor, which is a self-signed certificate. Such trust anchors typically create intermediate certificates which are used to sign CSR's. The trust entails that the CA has established that the private key belongs to the identity specified in the certificate with matching public key.</p>
<p>Operating systems or software suites are often deployed with well known and widely trusted CA's that verify identity against network names.</p>
<p>The context of a TLS connection is handled by the <a class="el" href="classdodo_1_1network_1_1TLSContext.html" title="TLS security context.">dodo::network::TLSContext</a> class. It is configured with a private key, a certificate and a truststore. The same TLSContext can be used by multiple <a class="el" href="classdodo_1_1network_1_1TLSSocket.html" title="Socket for TLS encrypted traffic between trusted endpoints.">dodo::network::TLSSocket</a> objects for multiple connections.</p>
<p>TLS evolved through protocol versions, version 1.0 is deprecated (as are its predecessors, SSLv2 and SSLv3).</p>
<ul>
<li>TLS 1.0 : Deprecated and not supported</li>
<li>TLS 1.1 : Deprecated but still supported</li>
<li>TLS 1.2 : Widely used</li>
<li>TLS 1.3 : Best</li>
</ul>
<p>Dodo allows to specify the lowest acceptable TLS version:</p>
<ul>
<li><a class="el" href="classdodo_1_1network_1_1TLSContext.html#a7151ee4f6b6e404c92722a155fceb343a09d4e1ecd9d58b5dca1a32f061f1d458" title="TLS 1.1 disables SSLv2, SSLv3 and TLS 1.0.">dodo::network::TLSContext::TLSVersion::tls1_1</a> Accept TLS 1.1 or better</li>
<li><a class="el" href="classdodo_1_1network_1_1TLSContext.html#a7151ee4f6b6e404c92722a155fceb343a34ce5bbe8056e475564e2e2316a7b5be" title="TLS 1.2 disables SSLv2, SSLv3, TLS 1.0 and TLS 1.1.">dodo::network::TLSContext::TLSVersion::tls1_2</a> Accept TLS 1.2 or better</li>
<li><a class="el" href="classdodo_1_1network_1_1TLSContext.html#a7151ee4f6b6e404c92722a155fceb343ab21e6d55ef15b3a52a1a656cc4a6bfba" title="TLS 1.3 disables SSLv2, SSLv3, TLS 1.0, TLS 1.1 and TLS 1.2.">dodo::network::TLSContext::TLSVersion::tls1_3</a> Accept TLS 1.3 or better</li>
</ul>
<p>In order to verify a peer certificate, there is <a class="el" href="classdodo_1_1network_1_1TLSContext.html#ac52323d8c8ebb0024a917ab92640ee7d" title="The TLS peer verification method.">dodo::network::TLSContext::PeerVerification</a></p>
<ul>
<li><a class="el" href="classdodo_1_1network_1_1TLSContext.html#ac52323d8c8ebb0024a917ab92640ee7dabc2760983296cae737de97348bc19a9d" title="No peer verification - transmission is encrypted, peer is accepted even if peer certificate is invali...">dodo::network::TLSContext::PeerVerification::pvVerifyNone</a> - Use no peer verification. The connection is private (encrypted), but information is shared with an unknown peer identity (like a man in the middle).</li>
<li><a class="el" href="classdodo_1_1network_1_1TLSContext.html#ac52323d8c8ebb0024a917ab92640ee7da59c4417e239a14944b29e82b8f68fcdb" title="The peer must have a trusted certificate (unless a anonymous cipher is used).">dodo::network::TLSContext::PeerVerification::pvVerifyPeer</a> - The client verifies that peer offers a certificate that is signed by an entity trusted by the client. Note that this merely proves the server has a copy of a trusted certificate - but for the peer to decrypt messages sent by the advertised public key, the peer must also have the private key to decrypt.</li>
<li><a class="el" href="classdodo_1_1network_1_1TLSContext.html#ac52323d8c8ebb0024a917ab92640ee7dabb1355627929f6d13a5bf081139375d2" title="As pvVerifyPeer, but the remote DNS name must match either the peer cert commonname or match one of t...">dodo::network::TLSContext::PeerVerification::pvVerifyFQDN</a> - In addition to pvVerifyPeer, the client verifies that the target FQDN of the server either matches its CN (common name) or one of its <a href="https://en.wikipedia.org/wiki/Subject_Alternative_Name">SAN</a> entries.</li>
</ul>
<p>On top of the verification methods provided by openSSL, one can obviously add additional checks, such as matching the fingerprint of the peer's certificate against a whitelist, inspecting additional SAN fields and so on.</p>
<h4>Trust stores</h4>
<p>Operating systems are typically configured with a truststore, on this Linux box a directory with certificates:</p>
<div class="fragment"><div class="line">$ ls -1 /etc/ssl/certs/*Nederland*</div>
<div class="line">/etc/ssl/certs/Staat_der_Nederlanden_EV_Root_CA.pem</div>
<div class="line">/etc/ssl/certs/Staat_der_Nederlanden_Root_CA_-_G2.pem</div>
<div class="line">/etc/ssl/certs/Staat_der_Nederlanden_Root_CA_-_G3.pem</div>
</div><!-- fragment --><p>EV is short for <a href="https://en.wikipedia.org/wiki/Extended_Validation_Certificate">Extended Validation Certificate</a>, which certifies that the legal identity of the certificate's owner has been verified.</p>
<p>Certificates can be inspected with</p>
<div class="fragment"><div class="line">$ openssl x509 -in /etc/ssl/certs/Staat_der_Nederlanden_EV_Root_CA.pem -text -noout</div>
<div class="line">Certificate:</div>
<div class="line">    Data:</div>
<div class="line">        Version: 3 (0x2)</div>
<div class="line">        Serial Number: 10000013 (0x98968d)</div>
<div class="line">        Signature Algorithm: sha256WithRSAEncryption</div>
<div class="line">        Issuer: C = NL, O = Staat der Nederlanden, CN = Staat der Nederlanden EV Root CA</div>
<div class="line">        Validity</div>
<div class="line">            Not Before: Dec  8 11:19:29 2010 GMT</div>
<div class="line">            Not After : Dec  8 11:10:28 2022 GMT</div>
<div class="line">        Subject: C = NL, O = Staat der Nederlanden, CN = Staat der Nederlanden EV Root CA</div>
<div class="line">        Subject Public Key Info:</div>
<div class="line">            Public Key Algorithm: rsaEncryption</div>
<div class="line">                RSA Public-Key: (4096 bit)</div>
<div class="line">                Modulus:</div>
<div class="line">                  ...</div>
</div><!-- fragment --><p>The modulus is shared between the private and public key (which is included in the certificate) and allows to match public keys and private keys as pairs (equality is inferred from matching sha256 hashes in this example)</p>
<div class="fragment"><div class="line"># for a private key</div>
<div class="line">$ openssl rsa -noout -modulus -in server_private.pem | openssl sha256</div>
<div class="line">(stdin)= 6158bf2941f9f2bd10d35f254cfa035f2c33bd36412beaf8427e51c99290b451</div>
<div class="line"> </div>
<div class="line"># for a public key</div>
<div class="line">$ openssl rsa -noout -modulus -pubin -in server_public.pem  | openssl sha256</div>
<div class="line">(stdin)= 6158bf2941f9f2bd10d35f254cfa035f2c33bd36412beaf8427e51c99290b451</div>
<div class="line"> </div>
<div class="line"># for a CSR</div>
<div class="line">$ openssl req -noout -modulus -in server_csr.pem | openssl sha256</div>
<div class="line">(stdin)= 6158bf2941f9f2bd10d35f254cfa035f2c33bd36412beaf8427e51c99290b451</div>
<div class="line"> </div>
<div class="line"># for a public key certificate</div>
<div class="line">$ openssl x509 -noout -modulus -in certificate.pem | openssl sha256</div>
<div class="line">(stdin)= 6158bf2941f9f2bd10d35f254cfa035f2c33bd36412beaf8427e51c99290b451</div>
</div><!-- fragment --><p>the output of the above commands proves that these public key artifacts all originate in the same private key.</p>
<p>Instead of the system trust store, a custom truststore can be used to fine-tune the trust. This allows to either limit the trust or trust one's own CA - bypassing the need to buy the certificate produced from a CSR.</p>
<p>Custom truststores are loaded from PCKS12 files through dodo::network::TLSContext::loadPKCS12TrustStore.</p>
<h4>Keystore</h4>
<p>A keystore comrpises the private key and the (signed) certificate of the identity. It can be loaded with either <a class="el" href="classdodo_1_1network_1_1TLSContext.html#a8ba59bffeb41e4f79342ba5c2bdd05d0" title="Load a certificate and the corresponding private key for an identity.">dodo::network::TLSContext::loadPEMIdentity</a> or dodo::network::TLSContext::loadPKCS12KeyStore.</p>
<h4>Server Name Indication</h4>
<p><a href="https://en.wikipedia.org/wiki/Server_Name_Indication">Server Name Indication</a> is a TLS extension that sends the client-intended target FQDN to allow the server to present the correct certificate - a certificate to which that target FQDN matches either the CN or one of the SANs.</p>
<p>Currently, SNI sends the target FQDN unencrypted, which means intermediates know the destination (and can act upon it, such as censoring). SNI seems to be required only by a minority of HTTPS servers, and due to its downsides,</p>
<p>SNI is enabled only if explicitly specified in the <a class="el" href="classdodo_1_1network_1_1TLSContext.html#a2043e1cad68876c5c9cf9ba8da9fde4e" title="Construct a TLS context.">dodo::network::TLSContext::TLSContext</a> constructor.</p>
<h3><a class="anchor" id="autotoc_md22"></a>
Setup Certification Authority</h3>
<p>The source tree contains a simplistic CA install that allows to operate as a root CA. The installation uses intermediate CA to do the actual signing. The installation can create signed server and client certificates to be shared with their Subjects (including private key and passphrase). Alternatively, external identities can provide a CSR that can be signed - ot nor.</p>
<p>The root CA install is protected by a single master passphrase. The root CA and intermediate CA private keys are protected with a individual passphrases, which are stored as a (readonly) files, each protected by the master passphrase. No readable secrets are stored. It is crucial that the master passphrase is strong and is remembered or safely kept - once it is lost the install is lost as well.</p>
<p>The scripts to install are part of the source, under <code>src/examples/tls/artefacts</code>. This install uses the confd tool, so that must be present in the PATH, as well as the openssl bianry.</p>
<p>Copy <code>config.yaml</code> and customize the copy. The <code>ca::root::directory</code> entry specifies the installation directory for the root CA directory tree. The <code>create-ca.sh</code> script will ask for the master passphrase.</p>
<p>Passphrases are passed to the openssl tools through ENV vars, and ENV vars of any user are readable to the root user, at least during the time they exist (only when installed scripts are running), so one must either be root or trust root if any serious use is considered.</p>
<div class="fragment"><div class="line">$ cp -p config.yaml myconfig.yaml</div>
<div class="line">$ vi myconfig.yaml</div>
<div class="line">$ ./configure.sh myconfig.yaml</div>
<div class="line">$ ./ca_config/bin/create-ca.sh</div>
</div><!-- fragment --><p>The <code>ca::root::directory</code> from <code>myconfig.yaml</code> now contains the root CA with a self-signed certificate. Now create an intermediate CA. Intermediate CA's are used to sign CSR's. Specify a descriptive name for the intermediate CA.</p>
<div class="fragment"><div class="line">$ cd [ca::root::directory]</div>
<div class="line">$ bin/create-intermediate.sh</div>
</div><!-- fragment --><p>the intermediate CA is now created, along with its certificate that is signed by the root CA created earlier.</p>
<p>Create a server identity (private key + passphrase, signing request). Note that the common name is expected to be the FQDN of the server, but SAN (subject altnames) can be specified to widen the certificate's applicability. Examples of SAN entries are</p>
<ul>
<li>DNS:our.domain.org</li>
<li>IP: 127.0.0.1</li>
<li>IP: ::1</li>
</ul>
<div class="fragment"><div class="line">$ bin/create-server.sh</div>
</div><!-- fragment --><p>Alternatively, the subject can create its own certificate, and just send a CSR. In case a CSR is received, best put it in <code>ca::root::directory/ext/servers</code> or <code>ca::root::directory/ext/servers</code> depending on the certificate's intended use.</p>
<p>Either way, the CSR can now be signed:</p>
<div class="fragment"><div class="line">$ intermediates/&lt;intermediatename&gt;/bin/sign-server-csr.sh &lt;CSR file&gt;</div>
</div><!-- fragment --><p>which will produce two files:</p>
<ul>
<li><code>ca/root/ext/servers|clients/&lt;commonname&gt;.cert.pem</code></li>
<li><code>ca/root/ext/servers|clients/&lt;commonname&gt;.pkcs12</code></li>
</ul>
<p>the former is the signed certificate, and the latter a PKCS12 file containing the signed certificate and the trust chain, both the intermediate and root certificates used to sign ().</p>
<p><code>&lt;server commonname&gt;.cert.pem</code> to be returned to the server identity.</p>
<div class="fragment"><div class="line">$ openssl s_server -accept 12345 -cert ca/root/ext/servers/localhost.cert.pem -CAfile ca/root/certs/ca.cert.pem -chainCAfile ca/root/intermediates/signer1/certs/ca-chain.cert.pem -key ca/root/ext/servers/localhost.key.pem</div>
<div class="line">$ openssl s_client -showcerts -connect localhost:12345 -CAfile /etc/ssl/certs/dodo.pem</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md23"></a>
TCPListener / TCPServer</h1>
<p>Developers create their own network protocols on top of TCP by sub-classing <a class="el" href="classdodo_1_1network_1_1TCPServer.html" title="Used in conjunction with TCPListener to implement high speed, multithreaded TCP services.">dodo::network::TCPServer</a> and implement a request (reading) and response (handling + sending) mechanism of arbitrary complexity. The <a class="el" href="classdodo_1_1network_1_1TCPListener.html" title="The TCPListener listens, accepts connections and generates socket events to produce TCP work to a poo...">dodo::network::TCPListener</a> is a <a class="el" href="classdodo_1_1threads_1_1Thread.html" title="Abstract Thread class.">dodo::threads::Thread</a>, and once started will</p>
<ul>
<li>listen and accept TCP handshakes</li>
<li>listen for socket events (data to be read,hangup,error to handle) and produces it as work to the pool of TCPServer instances.</li>
<li>manage the pool of TCPServer worker threads, scale the number of TCPServer instances between a minimum and maximum depending on the amount of work queued for processing</li>
<li>throttle the production of work by delaying (throttling) the TCPListener reading socket events, if the queue depth exceed its maximum and the maximum number of TCPServer have already been started.</li>
</ul>
<p>As the <a class="el" href="classdodo_1_1network_1_1TCPServer.html" title="Used in conjunction with TCPListener to implement high speed, multithreaded TCP services.">dodo::network::TCPServer</a> and <a class="el" href="classdodo_1_1network_1_1TCPListener.html" title="The TCPListener listens, accepts connections and generates socket events to produce TCP work to a poo...">dodo::network::TCPListener</a> interfaces use <a class="el" href="classdodo_1_1network_1_1BaseSocket.html" title="Interface to and common implementation of concrete sockets (Socket, TLSSocket).">dodo::network::BaseSocket</a>, both do not depend on the socket being a regular or a TLS-secured socket.</p>
<p>The <a class="el" href="classdodo_1_1network_1_1TCPListener.html" title="The TCPListener listens, accepts connections and generates socket events to produce TCP work to a poo...">dodo::network::TCPListener</a> uses the epoll_wait interface to wait for and read socket events in its run() method, which is executed a dedicated thread. Only if there is socket activity (new connections, data to be read, errors, shutdowns) will the <a class="el" href="classdodo_1_1network_1_1TCPListener.html" title="The TCPListener listens, accepts connections and generates socket events to produce TCP work to a poo...">dodo::network::TCPListener</a> wake up, and read <code>pollbatch</code> socket events in one go (instead of waking up on each individual socket event). The <a class="el" href="classdodo_1_1network_1_1TCPListener.html" title="The TCPListener listens, accepts connections and generates socket events to produce TCP work to a poo...">dodo::network::TCPListener</a> does not read data, it merely signals the pool of <a class="el" href="classdodo_1_1network_1_1TCPServer.html" title="Used in conjunction with TCPListener to implement high speed, multithreaded TCP services.">dodo::network::TCPServer</a> there is data to be read through a std::condition_variable on which the TCPServer pool is sleeping.</p>
<p>The request-response paradigm comprises these steps</p>
<ul>
<li>A protocol handshake (not the TCP handshake, that will already have taken place), for example to verify clients speak the correct protocol or setup state-full data for the remainder of the connection. The handshake is implemented by overriding the virtual bool <a class="el" href="classdodo_1_1network_1_1TCPServer.html#afa42ebab2c90b1d1f2f849cd33dc4546" title="Override to perform a protocol handshake.">dodo::network::TCPServer::handShake()</a>, which should be returning false if the handshake fails, in which case the <a class="el" href="classdodo_1_1network_1_1TCPListener.html" title="The TCPListener listens, accepts connections and generates socket events to produce TCP work to a poo...">dodo::network::TCPListener</a> will clean up.</li>
<li>Zero or more request-response cyles by overriding <a class="el" href="classdodo_1_1network_1_1TCPServer.html#a61a111d94ab7c334b94b6ec2ca7e638f" title="Override to perform a request-response cycle.">dodo::network::TCPServer::readSocket()</a>. Note that the request data sent must be fully read within a single readSocket cycle, but if required a protocol can be created that reads across several requests (which would only serve a point if local RAM needs to be protected against very large request by applying streaming).</li>
<li>A shutdown when the peer hangs up or the socket is/must be terminated due to errors. Override <a class="el" href="classdodo_1_1network_1_1TCPServer.html#adfa99f2e9d5331269163bb63127409c8" title="Override to perform a shutdown.">dodo::network::TCPServer::shutDown()</a> when the <a class="el" href="classdodo_1_1network_1_1TCPServer.html" title="Used in conjunction with TCPListener to implement high speed, multithreaded TCP services.">dodo::network::TCPServer</a> needs to clean things up.</li>
</ul>
<p>Additionally, the devloper will need to override <a class="el" href="classdodo_1_1network_1_1TCPServer.html#a8945550a989ffe1c581b280431285184" title="Spawn a new TCPServer.">dodo::network::TCPServer::addServer()</a> to provide a new instance of a <a class="el" href="classdodo_1_1network_1_1TCPServer.html" title="Used in conjunction with TCPListener to implement high speed, multithreaded TCP services.">dodo::network::TCPServer</a> descendant so that dodo::network::TCPListner can spawn new servers.</p>
<p>The <a class="el" href="classdodo_1_1network_1_1TCPListener.html" title="The TCPListener listens, accepts connections and generates socket events to produce TCP work to a poo...">dodo::network::TCPListener</a> has some configuration parameters that define its runtime behavior, which are bundled in the <a class="el" href="structdodo_1_1network_1_1TCPListener_1_1Params.html" title="Parameters affecting TCPListener behavior.">dodo::network::TCPListener::Params</a> struct. These parameters can either be specified by C++ code or handed to a TCPListner instance by specifying a Config YAML node (which may thus appear anywhere in the YAML file). In the below example, the myapp.tcplistener node would be passed.</p>
<div class="fragment"><div class="line">myapp:</div>
<div class="line">  tcplistener:</div>
<div class="line">    listen-address: 0.0.0.0</div>
<div class="line">    listen-port: 1968</div>
<div class="line">    scaling:</div>
<div class="line">      min-servers: 2</div>
<div class="line">      max-servers: 16</div>
<div class="line">    sizing:</div>
<div class="line">      max-connections: 5000</div>
<div class="line">      send-buffer: 16384</div>
<div class="line">      receive-buffer: 32768</div>
<div class="line">    timeouts:</div>
<div class="line">      send: 10</div>
<div class="line">      receive: 10</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">name </th><th class="markdownTableHeadNone">dataype </th><th class="markdownTableHeadNone">default </th><th class="markdownTableHeadNone">purpose  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>listen-address</code> </td><td class="markdownTableBodyNone">string </td><td class="markdownTableBodyNone"><code>0.0.0.0</code> </td><td class="markdownTableBodyNone">The address to listen on, may be a local ipv4 or an ipv6 address. <code>0.0.0.0</code> (ipv4) and <code>::</code> (ipv6) imply IN_ADDRANY and will listen on all network interfaces.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>listen-port</code> </td><td class="markdownTableBodyNone">unsigned int </td><td class="markdownTableBodyNone"><code>1968</code> </td><td class="markdownTableBodyNone">The port to listen on.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>min-servers</code> </td><td class="markdownTableBodyNone">unsigned int </td><td class="markdownTableBodyNone"><code>2</code> </td><td class="markdownTableBodyNone">The minimum TCPServer threads in the pool.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>max-servers</code> </td><td class="markdownTableBodyNone">unsigned int </td><td class="markdownTableBodyNone"><code>16</code> </td><td class="markdownTableBodyNone">The maximum TCPServer threads in the pool.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>max-connections</code> </td><td class="markdownTableBodyNone">unsigned int </td><td class="markdownTableBodyNone"><code>1000</code> </td><td class="markdownTableBodyNone">The maximum number of connections (10-60000).  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>max-queue-depth</code> </td><td class="markdownTableBodyNone">unsigned int </td><td class="markdownTableBodyNone"><code>128</code> </td><td class="markdownTableBodyNone">The maximum number of queued work items before throttling.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>send-buffer</code> </td><td class="markdownTableBodyNone">unsigned int </td><td class="markdownTableBodyNone"><code>16384</code> </td><td class="markdownTableBodyNone">The size of the send buffer for each socket.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>receive-buffer</code> </td><td class="markdownTableBodyNone">unsigned int </td><td class="markdownTableBodyNone"><code>32768</code> </td><td class="markdownTableBodyNone">The size of the receive buffer for each socket.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>server-idle-ttl-s</code> </td><td class="markdownTableBodyNone">unsigned int </td><td class="markdownTableBodyNone"><code>300</code> </td><td class="markdownTableBodyNone">The number of second a TCPServer is allowed to be idle before scaling down (if # TCPServers &gt; min-severs).  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>poll-batch</code> </td><td class="markdownTableBodyNone">unsigned int </td><td class="markdownTableBodyNone"><code>128</code> </td><td class="markdownTableBodyNone">The number of socket events transformed into TCPServer work in a single cycle.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>listener-sleep-ms</code> </td><td class="markdownTableBodyNone">unsigned int </td><td class="markdownTableBodyNone"><code>1000</code> </td><td class="markdownTableBodyNone">The number of milliseconds to wait for socket events per TCPListener iteration before re-looping, allowing to check if the TCPListener is requested to stop.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>throttle-sleep-us</code> </td><td class="markdownTableBodyNone">unsigned int </td><td class="markdownTableBodyNone"><code>4000</code> </td><td class="markdownTableBodyNone">The number of microseconds to stall the TCPListener in case max-queue-depth is reached.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>cycle-max-throttles</code> </td><td class="markdownTableBodyNone">unsigned int </td><td class="markdownTableBodyNone"><code>40</code> </td><td class="markdownTableBodyNone">The maximum number of throttles per listener-sleep-ms cycle.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>stat-trc-interval-s</code> </td><td class="markdownTableBodyNone">unsigned int </td><td class="markdownTableBodyNone"><code>300</code> </td><td class="markdownTableBodyNone">The number of seconds between writing status/performance messages to the log.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>tcp-keep-alive</code> </td><td class="markdownTableBodyNone">bool </td><td class="markdownTableBodyNone"><code>false</code> </td><td class="markdownTableBodyNone">If true, enable TCP keep alive on client sockets.  </td></tr>
</table>
<p>To highlight the purpose and effect of the parameters, the TCPListener loop roughly iterates as</p>
<div class="fragment"><div class="line">while ( ! stopped ) {</div>
<div class="line">  throttle if needed, at max cycle-max-throttles times throttle-sleep-us microseconds</div>
<div class="line">  check if servers need to be added (when the queue size is not shrinking)</div>
<div class="line">  wait-sleep listener-sleep-ms for 1 to poll-batch socket events</div>
<div class="line">  if ( !timeout ) {</div>
<div class="line">    for new-connection events, setup the sockets, queue the handshake</div>
<div class="line">    for existing connections with events, queue the readSocket cycle</div>
<div class="line">  }</div>
</div><!-- fragment --><p>The implicit throttling mechanism of the TCPListener protects the TCPServer pool against overloading, and will queue client data in the hosts receive buffers initially, and if they are full, clients will start to experience send latency up until their send timeout values. So the TCPListener will seek to maximize the sustained arrival rate of work against the configured capacity of the TCPServer pool, although, as the receive buffers and request queue size permit, it can handle intermediate burst that exceed it without additional latency.</p>
<h1><a class="anchor" id="autotoc_md24"></a>
Persistent data</h1>
<h2><a class="anchor" id="autotoc_md25"></a>
SQLite wrapper</h2>
<p>The classes in the <code><a class="el" href="namespacedodo_1_1persist_1_1sqlite.html" title="C++ API to SQLite.">dodo::persist::sqlite</a></code> namespace simplify the use of SQLite.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="dodo_8hpp.html">dodo.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacedodo.html">dodo</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  <span class="keywordtype">int</span> exit_code = 0;</div>
<div class="line">  <span class="keyword">const</span> std::string database_name = <span class="stringliteral">&quot;mydb.sqlite&quot;</span>;</div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// open existing or create new database</span></div>
<div class="line">      <a class="code" href="classdodo_1_1persist_1_1sqlite_1_1Database.html">persist::sqlite::Database</a> db( database_name );</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// create a schema</span></div>
<div class="line">      <a class="code" href="classdodo_1_1persist_1_1sqlite_1_1DDL.html">persist::sqlite::DDL</a> schema( db );</div>
<div class="line">      schema.prepare( <span class="stringliteral">&quot;CREATE TABLE IF NOT EXISTS foo ( foo NOT NULL PRIMARY KEY)&quot;</span> );</div>
<div class="line">      schema.execute();</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// setup an insert statement</span></div>
<div class="line">      <a class="code" href="classdodo_1_1persist_1_1sqlite_1_1DML.html">persist::sqlite::DML</a> insert( db );</div>
<div class="line">      insert.prepare( <span class="stringliteral">&quot;INSERT INTO foo (foo) VALUES (?)&quot;</span> );</div>
<div class="line">      insert.bind( 1, <span class="stringliteral">&quot;insert1&quot;</span> );</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// start a transaction</span></div>
<div class="line">      db.beginTransaction();</div>
<div class="line">      insert.execute();</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// reset the query for re-execute with different value</span></div>
<div class="line">      insert.reset(<span class="keyword">true</span>);</div>
<div class="line">      insert.bind( 1, <span class="stringliteral">&quot;insert2&quot;</span> );</div>
<div class="line">      insert.execute();</div>
<div class="line"> </div>
<div class="line">      db.commit();</div>
<div class="line">      <span class="comment">// other persist::sqlite::Database objects will now see the inserts</span></div>
<div class="line"> </div>
<div class="line">      <span class="comment">// query and step the result set</span></div>
<div class="line">      <a class="code" href="classdodo_1_1persist_1_1sqlite_1_1Query.html">persist::sqlite::Query</a> qry( db );</div>
<div class="line">      qry.prepare( <span class="stringliteral">&quot;select foo from foo order by foo&quot;</span> );</div>
<div class="line">      <span class="keywordflow">while</span> ( qry.step() ) {</div>
<div class="line">        std::cout &lt;&lt; qry.getText(0) &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span> ( <span class="keyword">const</span> std::exception &amp;e ) {</div>
<div class="line">    <span class="comment">// as the db object is now destructed, any un-comitted transaction is</span></div>
<div class="line">    <span class="comment">// rolled back and the database is closed.</span></div>
<div class="line">    std::cerr &lt;&lt; e.what() &lt;&lt; std::endl;</div>
<div class="line">    exit_code = 1;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">// delete the database file</span></div>
<div class="line">  remove( database_name.c_str() );</div>
<div class="line">  <span class="keywordflow">return</span> exit_code;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md26"></a>
KVStore</h2>
<p>The <a class="el" href="classdodo_1_1persist_1_1KVStore.html" title="A persistent, multi-threaded key-value store backed by sqlite3 database (file).">dodo::persist::KVStore</a> class is a simple key-value store backed by SQLite. Under multithreading, if each thread uses its own KVStore object - even though they all point to the same SQLite file - no explicit synchronization is required.</p>
<ul>
<li>The SQLite database (file) is initialized in WAL mode for performance.</li>
<li>All key-value pairs are stored in a single table (kvstore).</li>
<li>The value column can hold any datatype that SQLite supports.</li>
<li>The modified column stores the (unix timestamp) of the last modification.</li>
<li>The updates column stores the total number of times the value was updated (after first insert this is 0).</li>
</ul>
<p>Suppose we require the hostname of a proxy server.</p>
<div class="fragment"><div class="line"><a class="code" href="classdodo_1_1persist_1_1KVStore.html">dodo::persist::KVStore</a> store( <span class="stringliteral">&quot;cm.db&quot;</span> );</div>
<div class="line">std::string proxy_server = store.ensureWidthDefault( <span class="stringliteral">&quot;proxy-server&quot;</span>, <span class="stringliteral">&quot;proxy.domain.nl&quot;</span> );</div>
</div><!-- fragment --><p>If the key <code>proxy-server</code> did not exist, it is now set to <code>"proxy.domain.nl"</code> in the store and that value is returned by <a class="el" href="classdodo_1_1persist_1_1KVStore.html#aaee004a033da74e40b5eee13b6e9304a" title="If the key does not exist, create it with the default and return the default.">dodo::persist::KVStore::ensureWithDefault</a>. If it did exist, the ensureWidthDefault function retruns the value from the store (and ignores the default). If a default cannot be set by the code and the key is just expected to be there, one could do</p>
<div class="fragment"><div class="line"><a class="code" href="classdodo_1_1persist_1_1KVStore.html">dodo::persist::KVStore</a> store( <span class="stringliteral">&quot;cm.db&quot;</span> );</div>
<div class="line">std::string proxy_server = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="keywordflow">if</span> ( store.getValue( <span class="stringliteral">&quot;proxy-server&quot;</span>, proxy_server ) ) {</div>
<div class="line">  ...</div>
<div class="line">} <span class="keywordflow">else</span> <span class="keywordflow">throw</span> std::runtime_error( <span class="stringliteral">&quot;key not found&quot;</span> )</div>
</div><!-- fragment --><p>For bulk inserts (<a class="el" href="classdodo_1_1persist_1_1KVStore.html#a8578963405b8ce070fe61179a4bd16e7" title="Insert a (key, string) pair.">dodo::persist::KVStore::insertKey</a>) or updates (<a class="el" href="classdodo_1_1persist_1_1KVStore.html#ac8ec7ef3eac8a32d5fefcc998c3435cc" title="Set the string value of an existing key.">dodo::persist::KVStore::setKey</a>), be sure to call <a class="el" href="classdodo_1_1persist_1_1KVStore.html#abf3f0694a3be71a024e7da59862d9817" title="Start a transaction.">dodo::persist::KVStore::startTransaction</a> before the modifications and <a class="el" href="classdodo_1_1persist_1_1KVStore.html#a1398b23278c0cae3c00daeb453f2248d" title="Commit a transaction.">dodo::persist::KVStore::commitTransaction</a> (or <a class="el" href="classdodo_1_1persist_1_1KVStore.html#a720eae7e51725189a7dfc970a99b9463" title="Rollback a transaction.">dodo::persist::KVStore::rollbackTransaction</a>) to speeds things up, as otherwise each modification will commit individually (this is seen to speed things up 1000x).</p>
<div class="fragment"><div class="line">store.startTransaction();</div>
<div class="line"><span class="keywordflow">for</span> ( <span class="keyword">const</span> <span class="keyword">auto</span> &amp;k : keys ) {</div>
<div class="line">  store.insertKey( k, random_string( rand() % DATA_MAX_LENGTH ) );</div>
<div class="line">}</div>
<div class="line">store.commitTransaction();</div>
</div><!-- fragment --><p>The KVStore can be run as an in-memory database by opening the special file <code>:memory:</code></p>
<div class="fragment"><div class="line"><a class="code" href="classdodo_1_1persist_1_1KVStore.html">dodo::persist::KVStore</a> store( <span class="stringliteral">&quot;:memory:&quot;</span> );</div>
</div><!-- fragment --><p>but its contents are lost when the store object closes (destructs). Refer to the <a href="https://sqlite.org/inmemorydb.html">SQLite documentation</a> for more details.</p>
<h1><a class="anchor" id="autotoc_md27"></a>
Performance</h1>
<p>The insertKey operations are enclosed between startTransaction / commitTransaction - all insertKey is comitted in one go. The setKey calls are individual commits. As a commit on persistent storage requires a physical write that has completed, the setKey speed is dominated by the write latency of the backing storage, as the huge difference in setKey speed below examplifies.</p>
<p><b>Intel Corei7 3.4GHz</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">storage </th><th class="markdownTableHeadNone">insertKey </th><th class="markdownTableHeadNone">getValue </th><th class="markdownTableHeadNone">setKey  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">memory </td><td class="markdownTableBodyNone"><code>575,000/s</code> </td><td class="markdownTableBodyNone"><code>1,000,000/s</code> </td><td class="markdownTableBodyNone"><code>345,000/s</code>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Samsung SSD 860 </td><td class="markdownTableBodyNone"><code>660,000/s</code> </td><td class="markdownTableBodyNone"><code>420,000/s</code> </td><td class="markdownTableBodyNone"><code>414/s</code>  </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aclassdodo_1_1persist_1_1KVStore_html"><div class="ttname"><a href="classdodo_1_1persist_1_1KVStore.html">dodo::persist::KVStore</a></div><div class="ttdoc">A persistent, multi-threaded key-value store backed by sqlite3 database (file).</div><div class="ttdef"><b>Definition:</b> <a href="kvstore_8hpp_source.html#l00077">kvstore.hpp:77</a></div></div>
<div class="ttc" id="aclassdodo_1_1persist_1_1sqlite_1_1Query_html"><div class="ttname"><a href="classdodo_1_1persist_1_1sqlite_1_1Query.html">dodo::persist::sqlite::Query</a></div><div class="ttdoc">Queries can take bind values and return select lists.</div><div class="ttdef"><b>Definition:</b> <a href="sqlite_8hpp_source.html#l00387">sqlite.hpp:387</a></div></div>
<div class="ttc" id="aclassdodo_1_1network_1_1Address_html"><div class="ttname"><a href="classdodo_1_1network_1_1Address.html">dodo::network::Address</a></div><div class="ttdoc">Generic network Address, supporting ipv4 and ipv6 transparently.</div><div class="ttdef"><b>Definition:</b> <a href="address_8hpp_source.html#l00090">address.hpp:90</a></div></div>
<div class="ttc" id="aclassdodo_1_1network_1_1Address_html_a7a68ac2e0566d16ddaad9c5484053d12"><div class="ttname"><a href="classdodo_1_1network_1_1Address.html#a7a68ac2e0566d16ddaad9c5484053d12">dodo::network::Address::getHostAddrInfo</a></div><div class="ttdeci">static common::SystemError getHostAddrInfo(const std::string &amp;hostname, AddrInfo &amp;info)</div><div class="ttdoc">Get Address information on a host in a AddrInfo struct.</div><div class="ttdef"><b>Definition:</b> <a href="address_8cpp_source.html#l00144">address.cpp:144</a></div></div>
<div class="ttc" id="anamespacedodo_html"><div class="ttname"><a href="namespacedodo.html">dodo</a></div><div class="ttdoc">A C++ platform interface to lean Linux services tailored for containerized deployment.</div><div class="ttdef"><b>Definition:</b> <a href="application_8hpp_source.html#l00029">application.hpp:29</a></div></div>
<div class="ttc" id="alogger_8hpp_html_a16c263117aeb5970df2838dffa168b70"><div class="ttname"><a href="logger_8hpp.html#a16c263117aeb5970df2838dffa168b70">log_Error</a></div><div class="ttdeci">#define log_Error(what)</div><div class="ttdoc">Macro to log Error.</div><div class="ttdef"><b>Definition:</b> <a href="logger_8hpp_source.html#l00277">logger.hpp:277</a></div></div>
<div class="ttc" id="adodo_8hpp_html"><div class="ttname"><a href="dodo_8hpp.html">dodo.hpp</a></div><div class="ttdoc">Includes all dodo headers.</div></div>
<div class="ttc" id="aclassdodo_1_1network_1_1SocketParams_html"><div class="ttname"><a href="classdodo_1_1network_1_1SocketParams.html">dodo::network::SocketParams</a></div><div class="ttdoc">Socket parameters - the family (domain), socket type and protocol triplet.</div><div class="ttdef"><b>Definition:</b> <a href="socketparams_8hpp_source.html#l00035">socketparams.hpp:35</a></div></div>
<div class="ttc" id="aclassdodo_1_1persist_1_1sqlite_1_1DML_html"><div class="ttname"><a href="classdodo_1_1persist_1_1sqlite_1_1DML.html">dodo::persist::sqlite::DML</a></div><div class="ttdoc">Data Modification Language statements can take bind values.</div><div class="ttdef"><b>Definition:</b> <a href="sqlite_8hpp_source.html#l00294">sqlite.hpp:294</a></div></div>
<div class="ttc" id="aclassdodo_1_1common_1_1Application_html"><div class="ttname"><a href="classdodo_1_1common_1_1Application.html">dodo::common::Application</a></div><div class="ttdoc">Red tape wrapper class for applications, from command line to services.</div><div class="ttdef"><b>Definition:</b> <a href="application_8hpp_source.html#l00061">application.hpp:61</a></div></div>
<div class="ttc" id="anamespacedodo_html_ae61f6a99a376fce96aaa28ef8fc99d24"><div class="ttname"><a href="namespacedodo.html#ae61f6a99a376fce96aaa28ef8fc99d24">dodo::initLibrary</a></div><div class="ttdeci">void initLibrary()</div><div class="ttdoc">Initialize the dodo library.</div><div class="ttdef"><b>Definition:</b> <a href="dodo_8hpp_source.html#l00041">dodo.hpp:41</a></div></div>
<div class="ttc" id="aclassdodo_1_1common_1_1SystemError_html"><div class="ttname"><a href="classdodo_1_1common_1_1SystemError.html">dodo::common::SystemError</a></div><div class="ttdoc">Linux system error primitive to provide a consistent interface to Linux error codes.</div><div class="ttdef"><b>Definition:</b> <a href="systemerror_8hpp_source.html#l00053">systemerror.hpp:53</a></div></div>
<div class="ttc" id="aclassdodo_1_1persist_1_1sqlite_1_1Database_html"><div class="ttname"><a href="classdodo_1_1persist_1_1sqlite_1_1Database.html">dodo::persist::sqlite::Database</a></div><div class="ttdoc">A STL friendly wrapper around the great sqlite3.</div><div class="ttdef"><b>Definition:</b> <a href="sqlite_8hpp_source.html#l00052">sqlite.hpp:52</a></div></div>
<div class="ttc" id="anamespacedodo_html_a0e6bd0f6e43779dd148e7fda07e67c23"><div class="ttname"><a href="namespacedodo.html#a0e6bd0f6e43779dd148e7fda07e67c23">dodo::closeLibrary</a></div><div class="ttdeci">void closeLibrary()</div><div class="ttdoc">Close the dodo library.</div><div class="ttdef"><b>Definition:</b> <a href="dodo_8hpp_source.html#l00051">dodo.hpp:51</a></div></div>
<div class="ttc" id="aclassdodo_1_1persist_1_1sqlite_1_1DDL_html"><div class="ttname"><a href="classdodo_1_1persist_1_1sqlite_1_1DDL.html">dodo::persist::sqlite::DDL</a></div><div class="ttdoc">Data Definition Language, SQL that takes no parameters, returns no data such as CREATE TABLE.</div><div class="ttdef"><b>Definition:</b> <a href="sqlite_8hpp_source.html#l00261">sqlite.hpp:261</a></div></div>
<div class="ttc" id="alogger_8hpp_html_a4b3fd9bbb39ca533a533155265dc9129"><div class="ttname"><a href="logger_8hpp.html#a4b3fd9bbb39ca533a533155265dc9129">log_Debug</a></div><div class="ttdeci">#define log_Debug(what)</div><div class="ttdoc">Macro to log Debug.</div><div class="ttdef"><b>Definition:</b> <a href="logger_8hpp_source.html#l00302">logger.hpp:302</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
